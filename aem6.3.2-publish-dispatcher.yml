version: '3'
services:
    aem632-publish:
        image: jmc22071983/aem632-publish:0.0.5-SNAPSHOT
        ports:
            - '4503:4503'
            - '8001:8001'
        environment:  
           RUNMODE: 'local'
        volumes:
            - 'aem632-publish:/crx-quickstart/repository'
            - 'aem632-publish:/crx-quickstart/logs'
        deploy:
            replicas: 1
            placement:
                constraints: 
                    - node.hostname == default
        networks:
            - network
    apache-dispatcher:
        image: jmc22071983/dispatcher:0.0.1
        depends_on:
            - aem632-publish
        ports:
            - '80:80'
            - '443:443'
        environment:  
            AEM_HOST: 'aem632-publish'
            AEM_PORT: '4503'
        volumes:
            - 'aem-dispatcher:/etc/httpd/dispatcher_cache'
            - 'aem-dispatcher:/logs:/etc/httpd/logs'
        deploy:
            replicas: 1
            placement:
                constraints: 
                    - node.hostname == default
        networks:
            - network 
volumes:
    aem632-publish:
    aem-dispatcher:
networks:
    network:
        driver: overlay